/**
 * jQuery for _WP plugin
 * @since 3.6
 * @copyright lightningspirit
 * @license GPLv2
 * @package WordPress
 * @subpackage _WP
 */
(function($){

$.fn.capitalize = function () {
    $.each(this, function () {
        var split = this.value.split(' ');
        for (var i = 0, len = split.length; i < len; i++) {
            split[i] = split[i].charAt(0).toUpperCase() + split[i].slice(1).toLowerCase();
        }
        this.value = split.join(' ');
    });
    return this;
};

// TinyMCE doesn't handle being moved in the DOM.  Destroy the
// editor instances at the start of a sort and recreate 
// them afterwards.
var _triggerAllEditors = function(event, creatingEditor) {
	var postbox, textarea;

	postbox = $(event.target);
	textarea = postbox.find('textarea.wp-editor-area');

	textarea.each(function(index, element) {
		var editor;
		editor = tinyMCE.EditorManager.get(element.id);
		if (creatingEditor) {
			if (!editor) {
				tinyMCE.execCommand('mceAddControl', true, element.id);
			}
		}
		else {
			if (editor) {
				editor.save();                                          
				tinyMCE.execCommand('mceRemoveControl', true, element.id);
			}       
		} 
	});
};

$(document).ready(function(){
	
	/* Fields form WP_Form class */

	// Destroy and institiate editor when sorting
	$('#poststuff').on('sortstart', function(event) {
		_triggerAllEditors(event, false);
	}).on('sortstop', function(event) {
		_triggerAllEditors(event, true);
	});

	// Input number
	$('input.number').spinner({
		culture : $(this).data('culture'),
		max : $(this).attr('max'),
		min : $(this).attr('min'),
		start : $(this).attr('start'),
		numberFormat : 'n',
		step : $(this).attr('step')
	});

	// Input currency
	$('input.currency').spinner({
		culture : $(this).data('culture'),
		max : $(this).attr('max'),
		min : $(this).attr('min'),
		start : $(this).attr('start'),
		numberFormat : 'C',
		step : $(this).attr('step')
	});

	// Progressbar
	$('div.progressbar').progressbar({
		max : $(this).attr('max'),
		value : $(this).attr('value'),
	});

	// Name
	$('input.name').on('keyup', function(){
		$(this).capitalize();
	});

	// Colorpicker
	$('input.color').wpColorPicker();


	// Date
	$('input.date').datepicker({
		showButtonPanel: true,
		dateFormat: $(this).data('dateFormat'),
		maxDate: $(this).data('maxDate'),
		minDate: $(this).data('minDate')
	});

	// Datetime
	$('input.datetime').datetimepicker({
		showButtonPanel: true,
		dateFormat: "yy-mm-dd",
		timeFormat: "HH:mm",
		maxDate: $(this).data('maxDate'),
		minDate: $(this).data('minDate'),
		hourMin: $(this).data('hourMin'),
		hourMax: $(this).data('hourMax'),
		stepHour: $(this).data('stepHour'),
		stepMinute: $(this).data('stepMinute'),
		stepSecond: $(this).data('stepSecond')
	});

	// Time
	$('input.time').timepicker({
		timeFormat: "HH:mm",
		hourMin: $(this).data('hourMin'),
		hourMax: $(this).data('hourMax'),
		stepHour: $(this).data('stepHour'),
		stepMinute: $(this).data('stepMinute'),
		stepSecond: $(this).data('stepSecond')
	});

	// Sortable
	$('ul.sortable').sortable({
    	placeholder: "ui-state-highlight"
    });

    // Selectable
    $('ul.selectable').selectable();


	

});

})(jQuery);